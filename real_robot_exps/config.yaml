# Real Robot Evaluation Configuration
# Training-specific parameters (gains, action bounds, EMA factor, obs_order) are loaded
# automatically from WandB training config - do NOT duplicate them here.

robot:
  ip: "192.168.1.11"
  use_mock: true              # Set false for real robot
  control_rate_hz: 15.0       # Must match training policy_hz
  reset_duration_sec: 3.0     # Duration for Cartesian reset motion

  # Standard Franka Hand NE_T_EE: 45deg Z rotation + 103.4mm Z offset (flange -> fingertip midpoint)
  # Column-major 4x4 homogeneous transform [R|t; 0 0 0 1]
  NE_T_EE: [
    0.7071, -0.7071, 0.0, 0.0,
    0.7071,  0.7071, 0.0, 0.0,
    0.0,     0.0,    1.0, 0.0,
    0.0,     0.0,    0.1034, 1.0
  ]

  # Stiffness frame = EE frame (identity) - forces measured at fingertip
  EE_T_K: [
    1.0, 0.0, 0.0, 0.0,
    0.0, 1.0, 0.0, 0.0,
    0.0, 0.0, 1.0, 0.0,
    0.0, 0.0, 0.0, 1.0
  ]

  # F/T EMA low-pass filter coefficient (applied at 1kHz inside read_state)
  # alpha=0.2 at 1kHz ~ 32Hz cutoff frequency (-3dB)
  ft_ema_alpha: 0.2

task:
  # Fixed asset position (hole position in world frame, meters)
  # This is "fixed_pos" in sim - used for OBSERVATIONS (fingertip_pos_rel_fixed = ee_pos - this)
  fixed_asset_position: [0.0, 0.0, 0.0]
  fixed_asset_orientation_quat: [1.0, 0.0, 0.0, 0.0]  # [w, x, y, z]

  # Target peg base position (where peg base should be when fully inserted)
  # This is "target_held_base_pos" in sim - used for SUCCESS/ENGAGEMENT DETECTION
  # May differ from fixed_asset_position depending on geometry
  target_peg_base_position: [0.0, 0.0, 0.0]

  # Offset from EE (fingertip midpoint) to peg base (grasped object root)
  # Needed to compute peg_base_pos = ee_pos + this offset for detection
  # Must be measured for your specific peg + gripper setup
  ee_to_peg_base_offset: [0.0, 0.0, -0.05]  # Example: peg extends 50mm below EE

  # Detection thresholds (matching IsaacLab factory env logic exactly)
  # Success: xy_dist < xy_centering_threshold AND z_disp < hole_height * success_threshold
  # Engagement: xy_dist < xy_centering_threshold AND z_disp < hole_height * engage_threshold
  xy_centering_threshold: 0.0025   # 2.5mm - HARDCODED in IsaacLab _get_curr_successes()
  hole_height: 0.025               # 25mm - asset-specific, used to scale Z thresholds
  success_threshold: 0.04          # Multiplied by hole_height -> 1mm Z threshold
  engage_threshold: 0.9            # Multiplied by hole_height -> 22.5mm Z threshold

  # Break detection (matches FragileObjectWrapper)
  break_force_threshold: 15.0      # N - L2 norm of force (Fx,Fy,Fz) >= this triggers break

  # Episode parameters
  episode_timeout_steps: 150       # Max steps per episode
  terminate_on_success: true       # True for real robot (no point continuing), False in sim

noise:
  # When true, use noise values defined below instead of WandB training config.
  # When false, load noise from WandB training config (matching sim exactly).
  use_rr_noise: false

  # Goal observation noise (Gaussian, sampled once per episode)
  goal_pos_noise: [0.001, 0.001, 0.001]   # meters, std per axis
  goal_yaw_noise: 0.0524                    # radians, std (~3 degrees)
  use_yaw_noise: false

  # Start pose (offset from fixed_asset_position)
  hand_init_pos: [0.0, 0.0, 0.047]         # meters, nominal EE offset above hole
  hand_init_pos_noise: [0.02, 0.02, 0.01]  # meters, uniform +/- range per axis
  hand_init_orn: [3.1416, 0.0, 0.0]        # RPY radians, nominal orientation (pointing down)
  hand_init_orn_noise: [0.0, 0.0, 0.785]   # RPY radians, uniform +/- range (~45 deg yaw)
